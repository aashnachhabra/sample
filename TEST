<%@ page import="com.optum.ideate.mongodb.domain.BenefitCategory" %> <%@ page import="java.util.List" %> <%@ page language="java" contentType="text/html; charset=UTF-8" pageEncoding="UTF-8" %> <%@taglib uri="http://java.sun.com/jsp/jstl/core" prefix="c" %> <%@ taglib uri="http://java.sun.com/jsp/jstl/functions" prefix="fn" %> <!doctype html> <html> <head> <meta charset="utf-8"> <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"> <script src="https://code.jquery.com/jquery-3.5.1.js" integrity="sha256-QWo7LDvxbWT2tbbQ97B53yJnYU3WhH/C8ycbRAkjPDc=" crossorigin="anonymous"></script> <link rel="stylesheet" href="css/UHCcustom.css"> <link rel="stylesheet" href="css/home.css"> <link rel="stylesheet" href="css/bootstrap.css"> <link rel="stylesheet" href="css/all.css"> <link rel="stylesheet" href="css/loader.css"> <script src="js/popper-1.14.3.min.js"></script> <script src="js/jquery-3.5.1.js"></script> <script src="js/datatables-1.11.5.min.js"></script> <script src="js/datatables-1.11.4.bootstrap4.min.js"></script> <script src="js/jquery-1.19.0.min.js"></script> <script src="js/lodash-4.17.10.min.js"></script> <script src="js/jquery-3.3.1.min.js"></script> <script src="js/UHCcustom.js"></script> <script src="js/bootstrap.min.js"></script> <script src="js/bootstrap-popup.min.js"></script> <script src="js/loader.js"></script> <script src="js/app/maximum-management.js"></script> <title>Plan Library</title> <link rel="icon" href="assets/PlanBuilderFavIcon.png"> <style> .table-striped tbody tr.highlight td { background-color: #ff0000; } .table-striped tbody tr.highlight { background-color: #ff0000; } .accordion-body .d-flex button { flex: 1; } .accordion-header .form-check-input { transform: scale(0.4); margin-right: 5px; } .accordion-button:not(.collapsed) .selectable-accordion strong, .accordion-button:not(.collapsed) .selectable-accordion small { color: var(--bs-primary) !important; } </style> <link href="js/frappe-datatable.min.css" rel="stylesheet"> <link rel="stylesheet" href="css/fontawesome.min.css"> <link rel="stylesheet" href="css/brands.min.css"> <link rel="stylesheet" href="css/solid.min.css"> </head> <body> <div id="main"> <%@include file="loader.jsp" %> <%@include file="header.jsp" %> <div class="text-primary" style="margin: 2em;"> <h1><i class="fa-solid fa-filter-circle-dollar"></i> Maximum Management</h1> </div> <div class="shadow-lg p-3 mb-5 bg-white rounded" style="margin:2em"> <form action="./maxManagementSearch" id="bcfilters" method="post" autocomplete="off"> <input type="hidden" id="ifpRoleId" value="${pageContext.session.getAttribute('ifpRoleId')}" /> <input type="hidden" name="validateCoc" id="validateCoc" value="" /> <div class="row"> <c:if test="${enabledCascade == 'true'}"> <span class="modal-title text-danger"> <b>Warning: </b> There are benefit limit changes that have not been cascaded to applicable plans. If you do not cascade these updates, the applicable plans will not receive the changes. If you leave this page the updates will be saved but not cascaded. </span> </c:if> </div> </br> <div class="row"> <div class="col"> <div class="form-floating"> <input type="text" class="form-control" data-key="" list="COCs" name="coc" value="${fn:escapeXml(maxManagementSearchRequest.coc != null ? maxManagementSearchRequest.coc : '')}" id="cocSeries" placeholder="COC Series" onchange="return validateSearch(true),resetIfInvalid(this),onCocChange();" onkeypress="return onlyNumberKey(event)"> <input type="hidden" name="cocId" id="cocId"> <label for="cocSeries" class="form-label">COC Series*</label> <datalist id="COCs"> <c:forEach var="coc" items="${maximumDD.cocSeriesMap}"> <option id="${coc.key}" name="${coc.value}">${coc.value} </option> </c:forEach> </datalist> </div> </div> <div class="col"> <div class="form-floating"> <input type="text" class="form-control" data-key="" list="states" name="stateName" value="${fn:escapeXml(maxManagementSearchRequest.stateName != null ? maxManagementSearchRequest.stateName : "")}" id="stateName" placeholder="State" onchange="return validateSearch(true),resetIfInvalid(this);" onkeypress="return enterKeyPressed(event)"> <input type="hidden" name="stateId" id="stateId"> <label for="stateName" class="form-label">State*</label> <datalist id="states"> <c:forEach var="state" items="${maximumDD.stateMap}"> <option id="${state.key}" name="${state.value}"> ${state.value}</option> </c:forEach> </datalist> </div> </div> <div class="col"> <div class="form-floating"> <input type="text" class="form-control" list="standards" name="standard" value="${fn:escapeXml(maxManagementSearchRequest.standard != null ? maxManagementSearchRequest.standard : "")}" id="standard" placeholder="Standard" onchange="return validateSearch(true),resetIfInvalid(this);" onkeypress="return enterKeyPressed(event)"> <input type="hidden" name="standardId" id="standardId"> <label for="standard" class="form-label">Product Family*</label> <datalist id="standards"> <c:forEach var="stand" items="${maximumDD.standardMap}"> <option id="${stand.key}" name="${stand.value}"> ${stand.value}</option> </c:forEach> </datalist> </div> </div> </div> <div class="d-flex gap-2 w-100 mb-3 mt-3"> <button class="btn btn-outline-warning btn-sm flex-fill" title="Change Tracking"> <i class="fas fa-exchange-alt"></i> Change Tracking </button> <button class="btn btn-outline-success btn-sm flex-fill" title="Export"> <i class="fas fa-file-export"></i> Export </button> <button type="button" class="btn btn-outline-primary btn-sm flex-fill" data-bs-toggle="modal" id="clone" ${pageContext.session.getAttribute('ifpRoleId')==10 ? "disabled" : ((pageContext.session.getAttribute('ifpRoleId')==8 || pageContext.session.getAttribute('ifpRoleId')==9 || pageContext.session.getAttribute('roleId')==4) && maxManagementSearchResponse.size()> 0 ?"":"disabled")} data-bs-target="#maxCloneModal" onclick="validateClone();"> <i class="fas fa-clone"></i> Clone Year/State/Product </button> <button type="button" class="btn btn-outline-primary btn-sm flex-fill" ${pageContext.session.getAttribute('ifpRoleId')==10 ? "disabled" : (pageContext.session.getAttribute('ifpRoleId')==8 || pageContext.session.getAttribute('ifpRoleId')==9 || pageContext.session.getAttribute('roleId')==4 ?"":"disabled")} id="newMaximum" data-bs-toggle="modal" data-bs-target="#editVisitLimitModal"> <i class="fas fa-plus" style="font-size: 20px;"></i> New Parent Maximum </button> <button type="button" class="btn btn-outline-warning btn-sm flex-fill" id="clearMaxManagement" ${pageContext.session.getAttribute('ifpRoleId')==10 ? "disabled" : ((pageContext.session.getAttribute('roleId')!=7 && maxManagementSearchResponse.size()> 0) ?"":"disabled")} onclick="clearSearch();"> <i class="fas fa-eraser"></i> Clear </button> <button type="submit" class="btn btn-outline-primary btn-sm flex-fill" id="bensearch" ${ pageContext.session.getAttribute('roleId')!=7 && maxManagementSearchResponse.size()==0 ? "disabled" :""} onclick="submitSearchForm();"> <i class="fas fa-search"></i> Search </button> </div> </form> <div> <div class="accordion w-100" id="maxAccordion"> <c:set var="prevKey" value="" /> <c:forEach var="maximumData" items="${maxManagementSearchResponse}" varStatus="loop"> <c:set var="currentKey" value="${maximumData.benCatName}_${maximumData.cocSeries}_${maximumData.state}_${maximumData.standard}" /> <c:if test="${currentKey ne prevKey}"> <c:set var="subCount" value="0" /> <c:forEach var="tmp" items="${maxManagementSearchResponse}"> <c:if test="${tmp.benCatName == maximumData.benCatName && tmp.cocSeries == maximumData.cocSeries && tmp.state == maximumData.state && tmp.standard == maximumData.standard}"> <c:set var="subCount" value="${subCount + 1}" /> </c:if> </c:forEach> <c:if test="${prevKey != ''}"> </tbody> </table> </div> </div> </div> </div> </c:if> <div class="accordion-item w-100 bt-1"> <h2 class="accordion-header" id="heading${loop.index}"> <div class="d-flex align-items-center w-100"> <input type="checkbox" class="form-check-input me-2" id="selectRowChk_${loop.index}" name="selectedRows" value="${maximumData.maxId}" onclick="toggleSelectRow(${loop.index});"> <div class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapse${loop.index}" aria-expanded="false" aria-controls="collapse${loop.index}"> <div class="d-flex w-100 justify-content-between align-items-center selectable-accordion m-2" id="accordionRow_${loop.index}"> <div class="d-flex align-items-center gap-2"> <strong>${maximumData.benCatName} (${subCount})</strong> <small class="text-muted"> - ${maximumData.cocSeries} - ${maximumData.state} - ${maximumData.standard}</small> </div> <div></div> </div> </div> </div> </h2> <div id="collapse${loop.index}" class="accordion-collapse collapse" aria-labelledby="heading${loop.index}"> <div class="accordion-body"> <div class="d-flex gap-2 mb-2"> <button class="btn btn-outline-danger btn-sm" title="Delete Parent" ${pageContext.session.getAttribute('ifpRoleId')==10 ? "disabled" : "" }> <i class="fas fa-trash"></i> Delete Parent </button> <button class="btn btn-outline-primary btn-sm" title="Copy Parent & Children"> <i class="fas fa-copy"></i> Copy Parent &amp; Children </button> <button class="btn btn-outline-success btn-sm" title="Add Child Maximum"> <i class="far fa-plus" style="font-size: 20px;"></i> Add Child Maximum </button> </div> <input type="hidden" name="benefitCategoryName" id="benefitCategoryName_${loop.index}" value="${maximumData.benCatName}"> <input type="hidden" name="row_${loop.index}" id="row_${loop.index}" value="0"> <input type="hidden" name="rescoc" id="rescoc_${loop.index}" value="${maximumData.cocSeries}"> <input type="hidden" name="resstateName" id="resstateName_${loop.index}" value="${maximumData.state}"> <input type="hidden" name="resstandard" id="resstandard_${loop.index}" value="${maximumData.standard}"> <div class="table-responsive"> <table class="table table-hover table-striped mb-0" id="newmaxtbl"> <thead> <tr> <th scope="col">Sub Category</th> <th scope="col">Visible</th> <th scope="col">Applies To</th> <th scope="col">Cross Applies</th> <th scope="col">Max Type</th> <th scope="col">Max Value</th> <th scope="col">Freq. Type</th> <th scope="col">Freq. Value</th> <th scope="col">Action</th> </tr> </thead> <tbody> </c:if> <tr> <td> <input type="hidden" name="subCategoryName_${loop.index}" id="subCategoryName_${loop.index}" value="" /> </td> <td> <i class="fas fa-times-circle text-danger" title="Not visible (placeholder)"></i> <input type="hidden" id="visiblePlaceholder_${loop.index}" value="false"> </td> <td> ${maximumData.appliesTo} <input type="hidden" name="appliesTo" id="appliesTo_${loop.index}" value="${maximumData.appliesTo}"> </td> <td> ${maximumData.crossApplies} <input type="hidden" name="crossApplies" id="crossApplies_${loop.index}" value="${maximumData.crossApplies}"> </td> <td> ${maximumData.maxType} <input type="hidden" name="maxType" id="maxType_${loop.index}" value="${maximumData.maxType}"> </td> <td> ${maximumData.maxValue} <input type="hidden" name="maxValue" id="maxValue_${loop.index}" value="${maximumData.maxValue}"> </td> <td> ${maximumData.freqType} <input type="hidden" name="freqType" id="freqType_${loop.index}" value="${maximumData.freqType}"> </td> <td> ${maximumData.freqValue} <input type="hidden" name="freqValue" id="freqValue_${loop.index}" value="${maximumData.freqValue}"> </td> <td> <div class="btn-group btn-group-sm" role="group"> <div class="btn-group"> <button class="btn btn-outline-primary" data-toggle="tooltip" data-placement="bottom" ${pageContext.session.getAttribute('ifpRoleId')==10 || pageContext.session.getAttribute('ifpRoleId')==8 || pageContext.session.getAttribute('ifpRoleId')==9 || pageContext.session.getAttribute('roleId')==4 ?"":"disabled"} title="Edit" data-bs-toggle="modal" data-bs-target="#editVisitLimitModal" data-value="${maximumData.benCatName}^${maximumData.appliesTo}^${maximumData.crossApplies}^${maximumData.maxType}^${maximumData.maxValue}^${maximumData.freqType}^${maximumData.freqValue}^${maximumData.maxId}" id="editMaximum" onclick="getMaxID(${maximumData.maxId})"> <i class="fas fa-edit"></i> </button> <input type="hidden" id="editMaximum_${maximumData.maxId}" data-value="${maximumData.benCatName}^${maximumData.appliesTo}^${maximumData.crossApplies}^${maximumData.maxType}^${maximumData.maxValue}^${maximumData.freqType}^${maximumData.freqValue}^${maximumData.maxId}"> <button class="btn btn-outline-danger" data-toggle="tooltip" data-placement="bottom" ${pageContext.session.getAttribute('ifpRoleId')==10 ? "disabled" : (pageContext.session.getAttribute('ifpRoleId')==8 || pageContext.session.getAttribute('ifpRoleId')==9 || pageContext.session.getAttribute('roleId')==4 ?"":"disabled")} title="Deactivate" data-bs-toggle="modal" id="deleteMaximum" onclick="deleteMaximum(${maximumData.maxId})"> <i class="fas fa-trash"></i> </button> </div> </div> </td> </tr> <c:set var="prevKey" value="${currentKey}" /> </c:forEach> <c:if test="${prevKey != ''}"> </tbody> </table> </div> </div> </div> </div> </c:if> <c:if test="${ empty maxManagementSearchResponse || maxManagementSearchResponse.size() == 0}"> <div class="p-3"> <p>No maximums configured. Please add a new maximum to begin or perform another search. </p> </div> </c:if> </div> </div> <div class="modal fade" id="ErrorModal" tabindex="-1" aria-labelledby="ErrorModalLabel" aria-hidden="true"> <div class="modal-dialog modal-dialog-centered"> <div class="modal-content"> <div class="modal-header"> <h5> <span id="Close" class="modal-title text-danger">Error</span> </h5> <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button> </div> <div class="modal-body" style="overflow: auto; overflow-wrap: break-word; width: 30em; max-height: 20em;"> <p> <span id="ErrorMesssage"></span> </p> </div> <div class="modal-footer"> <input type="submit" name="ErrorClose" value="Cancel" id="ErrorClose" class="btn btn-outline-danger" data-bs-dismiss="modal" autocomplete="off"> </div> </div> </div> </div> <div class="modal fade" id="editVisitLimitModal"> <div class="modal-dialog modal-lg modal-dialog-centered modal-dialog-scrollable"> <div class="modal-content"> <div class="modal-header"> <h5 class="modal-title" id="editVisitLimitModalLabel"></h5> <button type="button" class="btn-close" data-bs-dismiss="modal" onclick="ShowLeaveModel()"></button> </div> <div class="modal-body"> <form class="row g-3"> <input type="hidden" name="cocSeries" id="coc_Series" value="${maxManagementSearchRequest.coc}" /> <input type="hidden" name="state" id="state" value="${maxManagementSearchRequest.stateName}" /> <input type="hidden" name="standard" id="standard" value="${maxManagementSearchRequest.standard}" /> <input type="hidden" name="maxId" id="maxId" value="" /> <div class="visitlimit_benCat"> <label for="visitlimit_benCatType">Benefit Category<span style="color: red;">*</span></label> <select id="visitlimit_bencat_Type" class="form-control adddvisitlimitbutaction" data-toggle="tooltip" data-placement="top" ${pageContext.session.getAttribute('ifpRoleId')==10 ? "disabled" : "" } title="Required - Select a Benefit Category type."> <option selected value="">Select...</option> <c:forEach var="benCat" items="${benefitCategoryNames}"> <option id="${benCat}" name="${benCat}">${benCat}</option> </c:forEach> </select> </div> <div class="col-3"> <label for="visitlimit_1_limitType">Max Type</label> <select id="visitlimit_1_limitType" class="form-control adddvisitlimitbutaction" data-toggle="tooltip" data-placement="top" ${pageContext.session.getAttribute('ifpRoleId')==10 ? "disabled" : "" } title="Required - Select a max type."> <option selected value="">Select...</option> <c:forEach var="limitType" items="${limitTypes}"> <option id="${limitType}" name="${limitType}">${limitType} </option> </c:forEach> </select> </div> <div class="col-3"> <label for="visitlimit_1_limitValue">Max Value</label> <input id="visitlimit_1_limitValue" type="text" min=1 max=999999 oninput="validity.valid||(value='');" class="form-control adddvisitlimitbutaction" placeholder="" data-toggle="tooltip" ${pageContext.session.getAttribute('ifpRoleId')==10 ? "disabled" : "" } onchange="validateLimitValue(this)" data-placement="top" title="Required - Enter a number greater than 1."></input> </div> <div class="col-3"> <label for="visitlimit_1_limitFreq">Frequency Value</label> <input id="visitlimit_1_limitFreq" type="number" min=1 max=9999 oninput="validity.valid||(value='');" class="form-control adddvisitlimitbutaction" ${pageContext.session.getAttribute('ifpRoleId')==10 ? "disabled" : "" } placeholder="" data-toggle="tooltip" data-placement="top"></input> </div> <div class="col-3"> <label for="visitlimit_1_limitFreqType">Frequency Type</label> <select id="visitlimit_1_limitFreqType" class="form-control adddvisitlimitbutaction" data-toggle="tooltip" data-placement="top" ${pageContext.session.getAttribute('ifpRoleId')==10 ? "disabled" : "" } title="Required - Select Months, Years, or Lifetime."> <option selected value="">Select...</option> <c:forEach var="frequencyType" items="${frequencyTypes}"> <option id="${frequencyType}" name="${frequencyType}"> ${frequencyType}</option> </c:forEach> </select> </div> <div class="dropdown-divider"></div> <div class="form-group col-4"> <label for="visitlimit_limitCross_Applies"> Cross Applies</label> <select id="visitlimit_limitCrossApplies" class="form-control adddvisitlimitbutaction" data-toggle="tooltip" ${pageContext.session.getAttribute('ifpRoleId')==10 ? "disabled" : "" } data-placement="top"> <option selected value="">Select...</option> <c:forEach var="crossApply" items="${crossApplies}"> <option id="${crossApply}" name="${crossApply}">${crossApply} </option> </c:forEach> </select> </div> <div class="form-group col-4"> <label for="visitlimit_limit_Applies">Applies To</label> <select id="visitlimit_limitApplies" class="form-control " data-toggle="tooltip" data-placement="top" ${pageContext.session.getAttribute('ifpRoleId')==10 ? "disabled" : "" } title="Optional - Select applies to this limit."> <option selected value=" ">Select...</option> <c:forEach var="applies" items="${appliesTo}"> <option id="${applies}" name="${applies}">${applies}</option> </c:forEach> </select> </div> <div class="form-group col-4"></div> <div class="dropdown-divider"></div> <div class="col-2"> <div class="d-grid gap-2"> <button type="button" class="btn btn-block btn-outline-danger" data-bs-dismiss="modal" onclick="ShowLeaveModel()"> Cancel </button> </div> </div> <div class="col-2"> <div class="d-grid gap-2"> <button type="button" class="btn btn-block btn-outline-warning" ${pageContext.session.getAttribute("IfpRoleId")==10 ? "" : "disabled" } id="editVisitLimitModalClearBut">Clear </button> </div> </div> <div class="delete-maximum col-2"> <div class="d-grid gap-2"> <button type="button" class="btn btn-block btn-outline-danger" data-toggle="modal" data-target="#deltevisitlimitConf" id="editVisitLimitModalDeleteBut" ${pageContext.session.getAttribute("IfpRoleId")==10 ? "" : "disabled" } onclick="deleteMaximumFromEdit();">Delete </button> </div> </div> <div class="col-2"> <div class="d-grid gap-2"> <button type="button" class="btn btn-block btn-outline-primary" id="editVisitLimitModalSaveBut" ${pageContext.session.getAttribute("IfpRoleId")==10 ? "disabled" : "" } onclick="validateCoc('maxSave')" disabled>Save </button> </div> </div> </form> </div> </div> </div> </div> <div class="modal fade" id="sucessBoxNewMaximumModal" tabindex="-1" role="dialog" aria-labelledby="sucessBoxNewMaximumModalLabel" aria-hidden="true" data-bs-backdrop='static'> <div class="modal-dialog modal-dialog-centered" role="document"> <div class="modal-content"> <div class="modal-header"> <h5><span id="lblWarnTitle" class="modal-title text-success"> Success </span> </h5> <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close" onclick="reloadSearch();"></button> </div> <div class="modal-body" id="successResult"> </div> </div> </div> </div> <div class="modal fade" id="errorModal" tabindex="-1" aria-labelledby="errorModalLabel" aria-hidden="true"> <div class="modal-dialog modal-dialog-centered" role="document"> <div class="modal-content"> <div class="modal-header"> <h5><span id="ErrorClose" class="modal-title text-danger">Error</span></h5> <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close" onclick="reloadSearch();"></button> </div> <div class="modal-body" id="errorMesssage"></div> </div> </div> </div> <div class="modal fade" id="deleteConfirmBoxModal" tabindex="-1" role="dialog" aria-labelledby="deleteConfirmBoxModal" aria-hidden="true"> <div class="modal-dialog modal-dialog-centered" role="document"> <div class="modal-content"> <div class="modal-header"> <h5><span id="lblWarnTitle" class="modal-title text-danger"> Warning </span> </h5> <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button> </div> <div class="modal-body"> <input type="hidden" name="maxIdVal" id="maxIdVal" value="" /> Please confirm that you'd like to delete this selected plan? </div> <div class="modal-footer"> <input type="submit" value="Cancel" id="deleteClose" class="btn btn-outline-danger" data-bs-dismiss="modal" autocomplete="off"> <a onclick="deleteMaximumData()" id="deleteConfirmVal" class="btn btn-outline-success" data-dismiss="modal">Confirm</a> </div> </div> </div> </div> <!-- Clone Modal --> <div class="modal fade" id="maxCloneModal" tabindex="-1" aria-labelledby="maxCloneModalLabel" aria-hidden="true"> <div class="modal-dialog modal-dialog-centered"> <div class="modal-content"> <div class="modal-header"> <h5 class="modal-title" id="maxCloneModalLabel">Clone New Maximum Configuration </h5> <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button> </div> <div class="modal-body"> <input type="hidden" name="cloneBenefitCategoryName" id="cloneBenefitCategoryName"> <input type="hidden" name="cloneAppliesTo" id="cloneAppliesTo"> <input type="hidden" name="cloneCrossAppliesTo" id="cloneCrossAppliesTo"> <input type="hidden" name="cloneMaxType" id="cloneMaxType"> <input type="hidden" name="cloneMaxValue" id="cloneMaxValue"> <input type="hidden" name="cloneFreqType" id="cloneFreqType"> <input type="hidden" name="cloneFreqValue" id="cloneFreqValue"> <div class="mb-3"> <div class="form-floating"> <input type="text" class="form-control" list="COCs" id="cloneCoc" name="cloneCoc" placeholder="COCSeries" onchange="resetIfInvalid(this),enableClone(this),getCloneIfpDropdowns();"> <label for="cloneCOCs" class="form-label">COC Series</label> <datalist id="cloneCOCs"> <c:forEach var="coc" items="${maximumDD.cocSeriesMap}"> <option id="${coc.key}" name="${coc.value}">${coc.value} </option> </c:forEach> </datalist> </div> </div> <div class="mb-3"> <div class="form-floating"> <input type="text" class="form-control" list="states" id="cloneState" name="cloneState" placeholder="State" onchange="resetIfInvalid(this),enableClone(this)"> <label for="clostates" class="form-label">State</label> <datalist id="clostates"> <c:forEach var="state" items="${maximumDD.stateMap}"> <option id="${state.key}" name="${state.value}">${state.value} </option> </c:forEach> </datalist> </div> </div> <div class="mb-3"> <div class="form-floating"> <input type="text" class="form-control" list="clonestandards" id="cloneStandard" name="cloneStandard" placeholder="Standard" onchange="resetIfInvalid(this),enableClone(this)"> <label for="clonestandard" class="form-label">Product Family</label> <datalist id="clonestandards"> <c:forEach var="stand" items="${maximumDD.standardMap}"> <option id="${stand.key}" name="${stand.value}">${stand.value} </option> </c:forEach> </datalist> </div> </div> </div> <div class="modal-footer"> <button type="button" class="btn btn-warning" data-bs-dismiss="modal">Cancel</button> <button type="button" class="btn btn-success" disabled="" id="clonebtn" onclick="cloneAjaxWithBenCatCheck();">Clone</button> </div> </div> </div> </div> <!-- Modal --> <div class="modal fade" id="exampleModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true"> <div class="modal-dialog" role="document"> <div class="modal-content"> <div class="modal-header"> <h5 class="modal-title" id="exampleModalLabel">Leave site?</h5> <button type="button" class="close" data-bs-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button> </div> <div class="modal-body"> Changes you made may not be saved. </div> <div class="modal-footer"> <button type="button" class="btn btn-secondary" data-bs-dismiss="modal" onclick="closeUpdateModel()">Leave</button> <button type="button" class="btn btn-primary" data-bs-dismiss="modal">Cancel</button> </div> </div> </div> </div> <div style="position: fixed; top: 1%; right: 40%; z-index: 1;" class="toast" data-autohide="false" id="success"> <div class="toast-header"> <strong class="mr-auto text-primary"> <i class="fas fa-square" style="color: #00a550"></i>Success </strong> <button type="button" style="margin-left: 13rem;" class="btn-close" data-bs-dismiss="toast"></button> </div> <div class="toast-body" style="background-color: #E8E8E8" id="successMessage"></div> </div> <div class="modal fade" id="cascadeLeaveModal" tabindex="-1" role="dialog" aria-labelledby="cascadeLeaveModalLabel" aria-hidden="true"> <div class="modal-dialog" role="document"> <div class="modal-content"> <div class="modal-header"> <h5 class="modal-title" id="cascadeLeaveLabel">Leave site?</h5> <button type="button" class="close" data-bs-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button> </div> <div class="modal-body"> Warning: there are benefit limit changes that have not been cascaded to applicable plans. If you do not cascade these updates, the applicable plans will not receive the changes. If you leave this page the updates will be saved but not cascaded. </div> <div class="modal-footer"> <a type="button" class="btn btn-secondary" data-bs-dismiss="modal" href="${pageContext.session.getAttribute('planlibraryUrl')}">Leave</a> <button type="button" class="btn btn-primary" data-bs-dismiss="modal" onclick="restricBrowserClose()">Cancel</button> </div> </div> </div> </div> </div> <%@include file="footer.html" %> </div> </body> </html>

when first time the page opens /maxManagement screen loads so there i wanna show all the data not search data
i have updated the existing /maxManagement api to get all data its displaying however the grouping logic which is also in this jsp to show multiple same benefit categories as inside accordion is working for only search but in the first load the grouping isnt working
for eg i have attached an image where benefit category coc series state and product family(standard) are all same yet they are shown as separate entries idk why. but everything is working fine on search the grouping logic
attaching relevant backend code for ref
@GetMapping("/maxManagement") public ModelAndView maximumManagement(ModelAndView modelAndView, HttpServletRequest request) { try { modelAndView.setViewName("MaximumManagement"); MaximumMgmtDDMapResponse maximumMgmtDDMapResponse; MaximumMgmtDDMapResponse maximumMgmtDDMapResponseForIEX; HttpSession session = request.getSession(); maximumMgmtDDMapResponse = maximumManagementService.getMaximumMgmtDropDownsMap(); maximumMgmtDDMapResponseForIEX = maximumManagementService.getMaximumMgmtDropDownsForIEXOrg(); maximumMgmtDDMapResponse.getStandardMap().clear(); maximumMgmtDDMapResponse.getStandardMap().putAll(maximumMgmtDDMapResponseForIEX.getStandardMap()); session.setAttribute("maximumMngDDMap", maximumMgmtDDMapResponse); modelAndView.addObject("maximumDD", maximumMgmtDDMapResponse); // âœ… Fetch all data for initial load List<MaximumManagementCollection> allMaxData = maximumManagementService.getAllMaxManagementData(); modelAndView.addObject("maxManagementSearchResponse", allMaxData); modelAndView.addObject("maxManagementSearchRequest", null); session.setAttribute("maxManagementSearchRequest", null); return modelAndView; } catch (Exception exception) { return ErrorUtil.validateErrorMessage(exception); } } @PostMapping("/maxManagementSearch") public ModelAndView getMaximumSearchData(@ModelAttribute PlanAssignmentRequest planAssignmentRequest, WebRequest request) { ModelAndView modelAndView = new ModelAndView(); Integer isCurrent = 1; DefaultSessionAttributeStore session = new DefaultSessionAttributeStore(); if (session.retrieveAttribute(request, "maxManagementSearchRequest") == null) { session.storeAttribute(request, "maxManagementSearchRequest", planAssignmentRequest); } MaximumMgmtDDMapResponse maximumMgmtDDMapResponse; if (session.retrieveAttribute(request, "maximumMngDDMap") == null) { maximumMgmtDDMapResponse = maximumManagementService.getMaximumMgmtDropDownsMap(); session.storeAttribute(request, "maximumMngDDMap", maximumMgmtDDMapResponse); } else { maximumMgmtDDMapResponse = (MaximumMgmtDDMapResponse) session.retrieveAttribute(request, "maximumMngDDMap"); } PlIFPDropdowns plIFPDropdowns = plIFPDropdownsRepository.findByCocSeriesAndIsCurrent(Integer.parseInt(planAssignmentRequest.getCoc()), isCurrent); if (ObjectUtils.isNotEmpty(plIFPDropdowns) && ObjectUtils.isNotEmpty(plIFPDropdowns.getProductFamily()) && ObjectUtils.isNotEmpty(maximumMgmtDDMapResponse)) { TreeMap<String, String> productFamilyTreeMap = plIFPDropdowns.getProductFamily() .stream() .filter(e -> e.getIsCurrent() == 1) .collect(TreeMap::new, (map, item) -> map.put(item.getName(), item.getName()), TreeMap::putAll); maximumMgmtDDMapResponse.setStandardMap(productFamilyTreeMap); } modelAndView.addObject("maximumDD", maximumMgmtDDMapResponse); List<MaximumManagementCollection> maximumList = maximumManagementService.getMaxSearchData(planAssignmentRequest); List<MaximumManagementCollection> filteredDeletedMaximumList = maximumList.stream().filter (e -> e.getStatus().equals(Constants.currentDeleted)).collect(Collectors.toList()); List<MaximumManagementCollection> filteredMaximumList = maximumList.stream().filter (e -> e.getStatus().equals(Constants.active)).collect(Collectors.toList()); modelAndView.addObject("enabledCascade", false); if (!filteredMaximumList.isEmpty()) { filteredMaximumList.forEach(request1 -> { if (request1.isBulkCascadeRequired()) { modelAndView.addObject("enabledCascade", true); } }); } List<MaximumManagementCollection> filteredCurrentDeletedList = maximumList.stream().filter (e -> e.getStatus().equals(Constants.currentDeleted)).collect(Collectors.toList()); if (!filteredCurrentDeletedList.isEmpty()) { filteredCurrentDeletedList.forEach(request1 -> { updateStatus(request1.getMaxId().intValue(), Constants.deleted); modelAndView.addObject("enabledCascade", true); }); } modelAndView.setViewName("MaximumManagement"); modelAndView.addObject("maxManagementSearchRequest", planAssignmentRequest); modelAndView.addObject("maxManagementSearchResponse", filteredMaximumList); List<MasterBenefitCategoryCollection> benefitCategoryList = productManagmentService.getMasterBenefitCategoryCollection(); List<String> benefitCategoryNames = new ArrayList<>(); if (CollectionUtils.isNotEmpty(benefitCategoryList)) { benefitCategoryList.stream().forEach(bcl -> benefitCategoryNames.add(bcl.getBenefitCategoryValue())); } benefitCategoryNames.sort(Comparator.naturalOrder()); modelAndView.addObject("benefitCategoryNames", benefitCategoryNames); List<String> limitTypes = Constants.limitType; List<String> frequencyTypes = Constants.frequencyType; List<String> appliesTo = Constants.appliesTo; if (plIFPDropdowns != null) { limitTypes = plIFPDropdowns.getLimitType() != null ? plIFPDropdowns.getLimitType() .stream().filter(e -> e.getIsCurrent() == 1) .map(DropdownOption::getName) .collect(Collectors.toList()) : Constants.limitType; frequencyTypes = plIFPDropdowns.getFrequencyType() != null ? plIFPDropdowns.getFrequencyType() .stream().filter(e -> e.getIsCurrent() == 1) .map(DropdownOption::getName) .collect(Collectors.toList()) : Constants.frequencyType; appliesTo = plIFPDropdowns.getAppliesTo() != null ? plIFPDropdowns.getAppliesTo() .stream().filter(e -> e.getIsCurrent() == 1) .map(DropdownOption::getName) .collect(Collectors.toList()) : Constants.appliesTo; } limitTypes.remove(" "); modelAndView.addObject("limitTypes", limitTypes); frequencyTypes.remove(" "); modelAndView.addObject("frequencyTypes", frequencyTypes); appliesTo.remove(" "); appliesTo.sort(Comparator.naturalOrder()); modelAndView.addObject("appliesTo", appliesTo); List<String> crossApplies = Constants.crossApplies; crossApplies.remove(" "); modelAndView.addObject("crossApplies", crossApplies); return modelAndView; } @Override public List<MaximumManagementCollection> getMaxSearchData(PlanAssignmentRequest planAssignmentRequest) { List<MaximumManagementCollection> maxList = null; try { maxList = maxRepository.findByCocSeriesAndStateAndStandard(Long.parseLong(planAssignmentRequest.getCoc()), planAssignmentRequest.getStateName(), planAssignmentRequest.getStandard()); maxList.sort(Comparator.comparing(MaximumManagementCollection::getBenCatName)); } catch (Exception e) { logger.error(String.valueOf(e.getStackTrace())); } return maxList; } @Override public List<MaximumManagementCollection> getAllMaxManagementData() { List<MaximumManagementCollection> maxList = new ArrayList<>(); try { maxList = maxRepository.findAll(); // Fetch all records // Optional: filter active records only maxList = maxList.stream() .filter(e -> e.getStatus().equals(Constants.active)) .sorted(Comparator.comparing(MaximumManagementCollection::getBenCatName)) .collect(Collectors.toList()); } catch (Exception e) { logger.error("Error fetching all MaximumManagement data: " + e.getMessage()); } return maxList; }

attached controller and serviceimpl snippets
