function getSearchData() { if (createRequestData() != null) { var request = createRequestData(); showAndHide(); $.ajax({ type: "POST", contentType: "application/json", url: "portfolioMgmtResponseTable", data: JSON.stringify(request), dataType: 'json', success: function (response) { if (response.length !== 0) { $('#datatable').css('display', 'block'); $('#noResult').css('display', 'none'); buildDatatable(response); } else { $('#noResult').css('display', 'block'); $('#datatable').css('display', 'none'); } showAndHide(); }, error: function (xhr) { $('#datatable').css('display', 'none'); $('#noResult').css('display', 'block'); showAndHide(); } }); } disabledButtons(); } function enableButtons() { let role = document.getElementById('role').value; let ifpRole = document.getElementById('ifpRole').value; console.log('Role is building', role); console.log('ifpRole is building', ifpRole); if (role != 7 && role != 1) { if (ifpRole != 10) { document.getElementById('deleteButton').disabled = false; document.getElementById('publishButton').disabled = false; document.getElementById('com360-btn').disabled = false; document.getElementById('exportPortfolio').disabled = false; document.getElementById('validateButton').disabled = false; document.getElementById('clonePortfolio').disabled = false; const bulkBtn = document.getElementById('createBulkCascadePlans'); if (bulkBtn && bulkBtn.dataset.roleLocked !== 'true') { bulkBtn.disabled = false; } } document.getElementById('editButton').disabled = false; } } function disabledButtons() { document.getElementById('deleteButton').disabled = true; document.getElementById('editButton').disabled = true; document.getElementById('publishButton').disabled = true; document.getElementById('com360-btn').disabled = true; document.getElementById('exportPortfolio').disabled = true; document.getElementById('validateButton').disabled = true; document.getElementById('clonePortfolio').disabled = true; const bulkBtn = document.getElementById('createBulkCascadePlans'); if (bulkBtn) bulkBtn.disabled = true; } function buildDatatable(inputdata) { let checkFlag = false; const datatable = new DataTable('#datatable', { columns: [ { name: 'Plan AssignmentId', id: 'planManagementId', editable: false, dropdown: false, }, { name: 'Plan Code', id: 'planCode', editable: false, }, { name: 'COC Series', id: 'cocSeries', editable: false, }, { name: 'State', id: 'stateAbbr', editable: false, }, { name: 'Plan Variant', id: 'planVariant', editable: false, }, { name: 'License', id: 'licenceCode', editable: false, }, { name: 'Legal Entity', id: 'legalEntityCode', editable: false, }, { name: 'Plan Status', id: 'planStatus', editable: false, }, { name: 'Sent To COM360?', id: 'sentToCOM360', editable: false }, { name: 'Published?', id: 'published', editable: false }, { name: 'Validated?', id: 'planValidateStatus', editable: false }, { name: 'Last Modified On', id: 'lastModifiedOn', editable: false, }, { name: 'Parent Plan AssignmentId', id: 'parentPlanManagementId', hidden: true }, { name: 'Version', id: 'version', editable: false, }, ], events: { onCheckRow: () => { let arrayrow = datatable.getRows(); let allWithdrawn = true; for (var i = 0; i < arrayrow.length; i++) { arrayrow[i][0].value = "false"; } this.checkedRows = this.datatable.rowmanager.getCheckedRows(); console.log("checked rows::::" + this.checkedRows); if (this.checkedRows.length <= 0) { disabledButtons(); } else { for (var i = 0; i < this.checkedRows.length; i++) { let rowIndex = this.checkedRows[i]; arrayrow[rowIndex][0].value = "true"; // Check if any selected row's status is NOT Withdrawn if (arrayrow[rowIndex][7].content !== 'Withdrawn') { allWithdrawn = false; } } enableButtons(); // Disable Validate button if all selected rows are Withdrawn const validateButton = document.getElementById("validateButton"); let role = document.getElementById('ifpRole').value; if(role == 10){ document.getElementById('exportPortfolio').disabled = false; } else{ validateButton.disabled = allWithdrawn; } } } }, data: inputdata, checkboxColumn: true, id: "planManagementId", inlineFilters: true, layout: 'fluid', serialNoColumn: false, noDataMessage: 'Awe Snap! No results returned. Please update your search criteria then try again.' }); datatable.style.setStyle(`.dt-cell__content .dt-cell__content--header-0`, { padding: '0' }); datatable.style.setStyle(`.dt-cell--header .dt-cell__content`, { overflow: 'visible' }); datatable.style.setStyle(`.dt-cell__content--col-0`, { overflow: 'visible' }); datatable.style.setStyle(`.dt-toast`, { top: '40px' }); datatable.style.setStyle(`.dt-scrollable`, { 'border-bottom': '1px solid #d1d8dd !important' }); window.datatable = datatable; } function createRequestData() { var request = {}; var planCode = $('#planCode').val(); request["planCode"] = planCode; var planName = $('#planName').val(); request["planName"] = planName; var currentHIOS = $('#hiosPlanID').val(); request["currentHIOSPlanID"] = currentHIOS; var planStatus = $('#planStatus').val(); request["planStatus"] = planStatus.length > 0 ? planStatus.toString() : ""; request["planType"] = "Medical"; request["segment"] = "SB"; request["organization"] = "IEX-Individual Exchange"; var licenseName = $('#licName').val(); request["licName"] = licenseName.length > 0 ? licenseName.toString() : ""; var cocName = $('#cocSeries').val(); request["coc"] = cocName.length > 0 ? cocName.toString() : ""; var statName = $('#stateName').val(); request["stateName"] = statName.length > 0 ? statName.toString() : ""; var standardName = $('#standard').val(); request["standard"] = standardName.length > 0 ? standardName.toString() : ""; var planValidateStatus = $('#planValidateStatus').val(); request["planValidateStatus"] = planValidateStatus.length > 0 ? planValidateStatus.toString() : ""; var metallicLevel = $('#metallicLevel').val(); request["metalLevel"] = metallicLevel.length > 0 ? metallicLevel.toString() : ""; var planVariant = $('#planVariant').val(); request["planVariant"] = planVariant.length > 0 ? planVariant.toString() : ""; if(currentHIOS == '' && planName == '' && licenseName.value == '' && cocName.value == '' && statName.value == '' && planCode == '' && planStatus == '' && standardName == '' && planValidateStatus == '' && metallicLevel == '' && planVariant.value == ''){ $("#errorModal").modal("toggle"); document.getElementById("ErrorMesssage").innerHTML = 'Please, enter value to Search'; $('#noResult').css('display', 'none'); $('#datatable').css('display', 'none'); return null; } else { return request; } } function validateDelete() { var planCode = $('#planCode').val(); var planType = $('#planType').val(); var stateName = $('#stateName').val(); var cocSeries = $('#cocSeries').val(); var organization = $('#organization').val(); var segment = $('#segment').val(); var licName = $('#licName').val(); var standard = $('#standard').val(); var planCategory = $('#planCategory').val(); if (planCode != "" || planType != "" || stateName != "" || cocSeries != "" || organization != "" || segment != "" || licName != "" || standard != "" || planCategory != "") { let planAssignmentArray = []; let checkedArray = datatable.getRows(); datatable.clearToastMessage(); for (var i = 0; i < checkedArray.length; i++) { if (checkedArray[i][0].value === 'true') { console.log(checkedArray); let content = checkedArray[i][1].content; console.log(content); planAssignmentArray.push(content); } } if (planAssignmentArray.length === 0) { $("#deleteErrorModal").modal("toggle"); document.getElementById("deleteErrorMesssage").innerHTML = 'Please, select one or more plans from the grid below.' } else { $("#deleteCfrmBoxModal").modal("toggle"); } } else { $("#deleteErrorModal").modal("toggle"); document.getElementById("deleteErrorMesssage").innerHTML = 'Please, enter value to Delete'; } } function deletePlan() { let planAssignmentArray = []; let checkedArray = datatable.getRows(); datatable.clearToastMessage(); for (var i = 0; i < checkedArray.length; i++) { if (checkedArray[i][0].value === 'true') { let content = checkedArray[i][1].content; let planCode = checkedArray[i][2].content; console.log(content); planAssignmentArray.push(content + "-" + planCode); } } var myHeaders = new Headers(); myHeaders.append("Content-Type", "application/json"); var request = {}; request["planAssignmentArray"] = planAssignmentArray; $("#deleteCfrmBoxModal").modal("toggle"); console.log(JSON.stringify(request)); showAndHide(); $.ajax({ type: "POST", contentType: "application/json", url: "deletePlan", data: JSON.stringify(request), dataType: 'json', success: function (res) { showAndHide(); getSearchData(); document.getElementById("successMessage").innerHTML = res.generateResult; $("#success").toast("show"); }, error: function (xhr) { showAndHide(); getSearchData(); console.log(xhr); $("#publishErrorMesssage").html("Something went wrong while deleting plans, please try again."); $("#publishErrorModal").modal("toggle"); } }); datatable.destroy(); disabledButtons(); } function planVariantError(planAssignmentArray) { var req = true; if (planAssignmentArray != null) { for (var i = 0; i < planAssignmentArray.length; i++) { if (planAssignmentArray[i].parentPlanManagementId !== "") { req = false; for (var j = 0; j < planAssignmentArray.length; j++) { if (planAssignmentArray[i].parentPlanManagementId == planAssignmentArray[j].planManagementId) { req = true; break;} } if(!req) return false; } } return req; } return false; } function basePlanSelected(planAssignmentArray) { if (planAssignmentArray != null) { for (var i = 0; i < planAssignmentArray.length; i++) { if (planAssignmentArray[i].parentPlanManagementId !== "") { return false; } } } return true; } function clonePlans() { const selectedCocSeries = document.getElementById('cocSeriesModal').value; console.log("selected coc", selectedCocSeries) let portfolioAssignmentArray = []; let checkedArray = datatable.getRows(); datatable.clearToastMessage(); for (var i = 0; i < checkedArray.length; i++) { if (checkedArray[i][0].value === 'true') { let content = checkedArray[i][1].content; portfolioAssignmentArray.push(content); } } var myHeaders = new Headers(); myHeaders.append("Content-Type", "application/json"); var request = {}; request["portfolioAssignmentArray"] = portfolioAssignmentArray; request["selectedCocSeries"] = selectedCocSeries; let planAssignmentArray = []; for (var i = 0; i < checkedArray.length; i++) { if (checkedArray[i][0].value === 'true') { let request1 = {}; request1["stateName"] = checkedArray[i][4].content; request1["planManagementId"] = checkedArray[i][1].content; request1["parentPlanManagementId"] = checkedArray[i][13].content; planAssignmentArray.push(request1); } } if (planAssignmentArray.length === 0) { document.getElementById("ErrorMesssage").innerHTML = 'Please, select one or more plans from the grid.'; $('#cloneCfrmBoxModal').modal('toggle'); $("#errorModalCOC").modal("toggle"); }else{ var isStateSame = checkStateSame(planAssignmentArray); if (!isStateSame) { document.getElementById("ErrorMesssage").innerHTML = 'You can only clone plans with the same state value. Please select plans with a single state to proceed.'; $('#cloneCfrmBoxModal').modal('toggle'); $("#errorModalCOC").modal("toggle"); } else { var planVariant = planVariantError(planAssignmentArray); if (!planVariant) { document.getElementById("ErrorMesssage").innerHTML = 'Base plan has not been selected and plan variants cannot be cloned on their own.'; $('#cloneCfrmBoxModal').modal('toggle'); $("#errorModalCOC").modal("toggle"); } else { var basePlanOnly = basePlanSelected(planAssignmentArray); if (!basePlanOnly) { $('#cloneCfrmBoxModal').modal('toggle'); $('#cloneCfrmChildBoxModal').modal('toggle'); getCloneChildPlanValue().then(cloneChildPlan => { request["cloneChildPlans"] = cloneChildPlan; console.log(JSON.stringify(request)); showAndHide(); $.ajax({ type: "POST", contentType: "application/json", url: "cloneMultiplePortfolioMgmtPlans", data: JSON.stringify(request), dataType: 'json', success: function (res) { showAndHide(); document.getElementById("cloneSuccessMessage").innerHTML = "Plan(s) cloned successfully"; $("#cloneSuccess").toast("show"); }, error: function (xhr) { showAndHide(); console.log(xhr); $("#publishErrorMesssage").html("Something went wrong while cloning plans, please try again."); $("#publishErrorModal").modal("toggle"); } }); datatable.destroy(); setTimeout(() => { getSearchData(); disabledButtons();}, 1500); }); } else { request["cloneChildPlans"] = false; console.log(JSON.stringify(request)); showAndHide(); $.ajax({ type: "POST", contentType: "application/json", url: "cloneMultiplePortfolioMgmtPlans", data: JSON.stringify(request), dataType: 'json', success: function (res) { showAndHide(); document.getElementById("cloneSuccessMessage").innerHTML = "Plan(s) cloned successfully"; $("#cloneSuccess").toast("show"); }, error: function (xhr) { showAndHide(); console.log(xhr); $("#publishErrorMesssage").html("Something went wrong while cloning plans, please try again."); $("#publishErrorModal").modal("toggle"); } }); $('#cloneCfrmBoxModal').modal('toggle'); datatable.destroy(); setTimeout(() => { getSearchData(); disabledButtons();}, 1500); } } } } } function getCloneChildPlanValue() { return new Promise((resolve) => { $('#yesConfirm').off('click').on('click', function () { $('#cloneCfrmChildBoxModal').modal('hide'); resolve(true); }); $('#noConfirm').off('click').on('click', function () { $('#cloneCfrmChildBoxModal').modal('hide'); resolve(false); }); }); } function openConfirmCloneModal() { $('#cloneCfrmBoxModal').modal('toggle'); } function checkStateSame(planAssignmentArray) { if (planAssignmentArray != null) { for (var i = 1; i < planAssignmentArray.length; i++) { if (planAssignmentArray[i].stateName !== planAssignmentArray[0].stateName) { return false; } } return true; } } function exportPlans() { let portfolioAssignmentArray = []; let checkedArray = datatable.getRows(); datatable.clearToastMessage(); for (var i = 0; i < checkedArray.length; i++) { if (checkedArray[i][0].value === 'true') { let content = checkedArray[i][1].content; let planCode = checkedArray[i][2].content; portfolioAssignmentArray.push(content + "-" + planCode); } } var myHeaders = new Headers(); myHeaders.append("Content-Type", "application/json"); var request = {}; request["portfolioAssignmentArray"] = portfolioAssignmentArray; let planAssignmentArray = []; for (var i = 0; i < checkedArray.length; i++) { if (checkedArray[i][0].value === 'true') { let request1 = {}; request1["planAssignmentId"] = checkedArray[i][1].content; request1["planCode"] = checkedArray[i][2].content; request1["coc"] = checkedArray[i][3].content; request1["stateName"] = checkedArray[i][4].content; console.log("object value" + JSON.stringify(request1)); planAssignmentArray.push(request1); } } var isCocSeriesAndStateSame = checkStateAndCocSeriesSame(planAssignmentArray); if (!isCocSeriesAndStateSame) { document.getElementById("ErrorMesssage").innerHTML = 'Exporting cannot be completed for plans spanning multiple States and / or COC Series'; $("#errorModalCOC").modal("toggle"); } else { console.log(JSON.stringify(request)); showAndHide(); $.ajax({ type: "POST", contentType: "application/json", url: "generateExportData", data: JSON.stringify(request), dataType: 'json', success: function (res) { showAndHide(); window.open("/ifp/portfolioDetailsExport.xls"); }, error: function (xhr) { showAndHide(); console.log(xhr); $("#publishErrorMesssage").html("Something went wrong while exporting plans, please try again."); $("#publishErrorModal").modal("toggle"); } }); datatable.destroy(); getSearchData(); disabledButtons(); } } function checkStateAndCocSeriesSame(planAssignmentArray) { if (planAssignmentArray != null) { for (var i = 1; i < planAssignmentArray.length; i++) { if (planAssignmentArray[i].coc !== planAssignmentArray[0].coc) { return false; } else if (planAssignmentArray[i].stateName !== planAssignmentArray[0].stateName) { return false; } } return true; } } function setTitle() { $('.dt-cell__content').each(function (i, obj) { if ($(this).children('input').attr('type') != 'checkbox' && ($(this).text()).trim()) { $(this).attr("title", $(this).text()); $(this).attr("data-toggle", "tooltip"); $(this).tooltip({ placement: 'top' }); $(this).attr("data-title", $(this).attr("title")); $(this).removeAttr("title"); } }); } setInterval(function () { $('.bs-tooltip-end').css('display', 'none'); }, 0); setInterval(function () { setTitle(); }, 1000); function createNewPlans() { $("#createNewPlanModal").modal("toggle"); console.log("Success"); } function addNewPlans() { $("#addNewPlanModal").modal("toggle"); console.log("Success"); } function setMultiSelectDropDown(id, filedName) { $(id).multiselect({ filterPlaceholder: 'Search for ' + filedName + '...', enableFiltering: true, enableCaseInsensitiveFiltering: true, includeSelectAllOption: true, maxHeight: 400, dropUp: true, nonSelectedText: filedName }); } $(document).ready(function() { setMultiSelectDropDown('#stateName','State'); setMultiSelectDropDown('#cocSeries','COC Series'); setMultiSelectDropDown('#standard','Product Family'); setMultiSelectDropDown('#planStatus','Plan Status'); setMultiSelectDropDown('#licName','License'); setMultiSelectDropDown('#planValidateStatus','Plan Validation Status'); setMultiSelectDropDown('#metallicLevel','Metallic Level'); setMultiSelectDropDown('#planVariant','Plan Variant'); disabledButtons(); var form = document.querySelector("form#createNewPlanModal-form"); form.addEventListener("submit", function (ev) { if ($("#createNewPlanModal-form").valid()) { document.getElementById("createNewPlanModal-form").submit(); } }); var validator = $("#createNewPlanModal-form").validate({ rules: { plansCount: { required: true, lessThan: 21 }, cocSeriesNew: { required: true, }, }, messages: { plansCount: { required: "Please enter a valid number.", lessThan: "Please enter a count less than or equal to 20." }, cocSeriesNew: { required: "Please select a COC Series value.", } } }); jQuery.validator.addMethod('lessThan', function (value, element, params) { return value < params; }); $("#createNewPlanClose, .btn-close").click(function () { validator.resetForm(); }); $('#createNewPlanModal').on('hidden.bs.modal', function () { validator.resetForm(); }); $(".serchfilters").keypress(function (event) { if (event.keyCode == 13 && event.key === "Enter") { event.preventDefault(); document.getElementById("btnSearch").click(); } }); }); function multiselectChange(event) { if($('#stateName').val().length == 0 && $('#cocSeries').val().length == 0 && $('#standard').val().length == 0 && $('#licName').val().length == 0 && $('#planStatus').val().length == 0 && $('#planCode').val() == "" && $('#planVariant').val().length == 0 && $('#planName').val() == "" && $('#hiosPlanID').val() == "" && $('#planValidateStatus').val().length == 0 && $('#metallicLevel').val().length == 0){ clearPortfolioSearch(); }else{ $('#btnSearch').prop('disabled', false); $('#clearPortfolio').prop('disabled', false); event.preventDefault(); } } function clearFields() { showAndHide(); setTimeout(function() { $('#state').val(""); $('#cocs').val(""); showAndHide(); }, 300); } function validateOneClickPublish() { const confirmButton = document.getElementById('confirmButton'); const state = $('#state').val(); const cocSeries = $('#cocs').val(); // Disable the button if either field is empty if (!state || !cocSeries) { confirmButton.disabled = true; return; } const request = state + "-" + cocSeries; const myHeaders = new Headers(); myHeaders.append("Content-Type", "application/json"); $.ajax({ type: "POST", contentType: "application/json", url: "validateStateCoc", data: request, dataType: 'json', success: function (res) { if (res.stateCoc === "valid") { confirmButton.disabled = false; } else { confirmButton.disabled = true; } }, error: function (xhr) { alert("Something went wrong while updating plans, please try again..!"); } }); } function oneClickConfirm(){ $("#oneClickPublishModal").modal("hide"); $("#oneClickCfrmBoxModal").modal("toggle"); } function oneClickRepublish(){ $("#oneClickCfrmBoxModal").modal("hide"); if ($('#state').val() != "" && $('#cocs').val() != "") { var state = $('#state').val(); var cocSeries = $('#cocs').val(); var request = (state + "-" + cocSeries); var myHeaders = new Headers(); myHeaders.append("Content-Type", "application/json"); $.ajax({ type: "POST", contentType: "application/json", url: "oneClickRepublish", data: request, dataType: 'json', success: function (res) { document.getElementById("publishSuccessMessage").innerHTML = res.publishResult; $("#publishSuccess").toast("show"); setTimeout(function () { window.location.reload(); }, 1000); }, error: function (xhr) { alert("Something went wrong while updating plans, please try again..!"); } }); datatable.destroy(); getSearchData(); disabledButtons(); } } function validatePublish() { let portfolioAssignmentArray = []; let checkedArray = datatable.getRows(); datatable.clearToastMessage(); var validPlan = true; var publishErrMsg = "Please select valid status plans for publish."; for (var i = 0; i < checkedArray.length; i++) { if (checkedArray[i][0].value == 'true') { let content = checkedArray[i][1].content; let pubStatus8 = checkedArray[i][8].content; if (pubStatus8 == null || pubStatus8 == "") { validPlan = false; } if (pubStatus8 === "Published" || pubStatus8 === "SentToCOM360") { $("#publishErrorMesssage").html("Plans are already published..No new changes to Publish"); $("#publishErrorModal").modal("toggle"); return; } portfolioAssignmentArray.push(content); } } if (portfolioAssignmentArray.length === 0) { $("#publishErrorMesssage").html(publishErrMsg); $("#publishErrorModal").modal("toggle"); } else { if (validPlan) { $("#publishCfrmBoxModal").modal("toggle"); } else { $("#publishErrorMesssage").html(publishErrMsg); $("#publishErrorModal").modal("toggle"); } } } function publishPlan() { let portfolioAssignmentArray = []; let checkedArray = datatable.getRows(); datatable.clearToastMessage(); for (var i = 0; i < checkedArray.length; i++) { if (checkedArray[i][0].value === 'true') { let content = checkedArray[i][1].content; let planCode = checkedArray[i][2].content; let status = checkedArray[i][8].content; console.log(content, status); if (status != null) { portfolioAssignmentArray.push(content + "-" + planCode); } } } var myHeaders = new Headers(); myHeaders.append("Content-Type", "application/json"); var request = {}; request["portfolioAssignmentArray"] = portfolioAssignmentArray; $("#publishCfrmBoxModal").modal("toggle"); console.log(JSON.stringify(request)); showAndHide(); $.ajax({ type: "POST", contentType: "application/json", url: "publishPortfolioMgmt", data: JSON.stringify(request), dataType: 'json', success: function (res) { showAndHide(); getSearchData(); document.getElementById("publishSuccessMessage").innerHTML = res.publishResult; $("#publishSuccess").toast("show"); }, error: function (xhr) { showAndHide(); console.log(xhr); alert("Error while publishing plans"); } }); datatable.destroy(); disabledButtons(); } function publishAllPlansOfStateCocSeriesCombination() { $("#publishAllCfrmBoxModal").modal("toggle"); } function publishAllPlansOfStateCocSeries() { console.log("publishAllPlansOfStateCocSeriesCombination"); var publishErrMsg = "Please select valid status plans for publish."; let portfolioAssignmentArray = []; let checkedArray = datatable.getRows(); let state = ''; let cocSeries = ''; datatable.clearToastMessage(); for (var i = 0; i < checkedArray.length; i++) { if (checkedArray[i][0].value === 'true') { let planAssigmentId = checkedArray[i][1].content; let planCode = checkedArray[i][2].content; cocSeries = checkedArray[i][3].content; state = checkedArray[i][4].content; let status = checkedArray[i][8].content; console.log(planAssigmentId, planCode, cocSeries, state, status); if (status != null && cocSeries != null && state != null && planAssigmentId != null) { portfolioAssignmentArray.push(planAssigmentId + "-" + cocSeries + "-" + state); } } } if (portfolioAssignmentArray.length === 0) { $("#publishErrorMesssage").html(publishErrMsg); $("#publishErrorModal").modal("toggle"); } else { var myHeaders = new Headers(); myHeaders.append("Content-Type", "application/json"); var request = {}; request["portfolioAssignmentArray"] = portfolioAssignmentArray; console.log(JSON.stringify(request)); showAndHide(); $.ajax({ type: "POST", contentType: "application/json", url: "publishAllPlansOfStateCocSeries", data: JSON.stringify(request), dataType: 'json', success: function (res) { $("#publishAllCfrmBoxModal").modal("hide"); showAndHide(); if (res.publishMsg == 'SelectedMultipleStateAndCocSeries') { $("#publishErrorMesssage").html("You have selected plans across multiple States and cocSeries. Please select plans for only one State and cocSeries when publishing"); $("#publishErrorModal").modal("toggle"); } else if (res.publishMsg == 'NotAllSelected') { $("#publishErrorMesssage").html("Please select ALL State " + state + " and cocSeries " + cocSeries + " plans before you publish"); $("#publishErrorModal").modal("toggle"); } else if (res.publishMsg == 'AllPublished') { $("#publishErrorMesssage").html("ALL Plans are already published for State " + state + " and cocSeries " + cocSeries + ", No new changes to Publish"); $("#publishErrorModal").modal("toggle"); } else { document.getElementById("publishSuccessMessage").innerHTML = res.publishMsg; $("#publishSuccess").toast("show"); } getSearchData(); }, error: function (xhr) { $("#publishAllCfrmBoxModal").modal("hide"); showAndHide(); getSearchData(); console.log(xhr); $("#publishErrorMesssage").html("Error while publishing plans"); $("#publishErrorModal").modal("toggle"); } }); } datatable.destroy(); disabledButtons(); } function validatePlans() { let checkedArray = datatable.getRows(); let hasWithdrawn = false; for (var i = 0; i < checkedArray.length; i++) { if (checkedArray[i][0].value === 'true') { if (checkedArray[i][8].content === 'Withdrawn') { hasWithdrawn = true; break; } } } if (hasWithdrawn) { document.getElementById("validatePlansCfrmBoxModalBody").innerHTML = "Are you sure you want to send all selected plan(s) to validate..? Note : Validation won't be performed on plans selected that are in a Withdrawn status" $("#validatePlansCfrmBoxModal").modal("toggle"); } else { document.getElementById("validatePlansCfrmBoxModalBody").innerHTML = "Are you sure you want to send all selected plan(s) to validate..?" $("#validatePlansCfrmBoxModal").modal("toggle"); } } function validateSelectedPlans() { console.log("sendPlansForValidation"); var validateErrMsg = "Please select at least one plan to validate."; let portfolioAssignmentArray = []; let checkedArray = datatable.getRows(); let state = ''; let cocSeries = ''; datatable.clearToastMessage(); for (var i = 0; i < checkedArray.length; i++) { if (checkedArray[i][0].value === 'true' && checkedArray[i][8].content !== 'Withdrawn') { let planAssigmentId = checkedArray[i][1].content; let planCode = checkedArray[i][2].content; cocSeries = checkedArray[i][3].content; state = checkedArray[i][4].content; let status = checkedArray[i][8].content; console.log(planAssigmentId, planCode, cocSeries, state, status); if (status != null && cocSeries != null && state != null && planAssigmentId != null) { portfolioAssignmentArray.push(planAssigmentId + "-" + cocSeries + "-" + state); } } } if (portfolioAssignmentArray.length === 0) { $("#publishErrorMesssage").html(validateErrMsg); $("#publishErrorModal").modal("toggle"); } else { var myHeaders = new Headers(); myHeaders.append("Content-Type", "application/json"); var request = {}; request["portfolioAssignmentArray"] = portfolioAssignmentArray; console.log(JSON.stringify(request)); showAndHide(); $.ajax({ type: "POST", contentType: "application/json", url: "sendPlansForValidation", data: JSON.stringify(request), dataType: 'json', success: function (res) { $("#validatePlansCfrmBoxModal").modal("hide"); showAndHide(); if(res.validateMsg == 'AllFailed') { $("#publishErrorMesssage").html("Failed to submit the selected Plan(s) for validation. Please try again later."); $("#publishErrorModal").modal("toggle"); } else { document.getElementById("validateSuccessMessage").innerHTML = res.validateMsg; $("#validateSuccess").toast("show"); } getSearchData(); }, error: function (xhr) { $("#validatePlansCfrmBoxModal").modal("hide"); showAndHide(); getSearchData(); console.log(xhr); $("#publishErrorMesssage").html("Error while validate plans"); $("#publishErrorModal").modal("toggle"); } }); } } function validateEdit() { var planCode = $('#planCode').val(); var planType = $('#planType').val(); var stateName = $('#stateName').val(); var cocSeries = $('#cocSeries').val(); var organization = $('#organization').val(); var segment = $('#segment').val(); var licName = $('#licName').val(); var standard = $('#standard').val(); var planCategory = $('#planCategory').val(); var request = {}; if (planCode != "" || planType != "" || stateName != "" || cocSeries != "" || organization != "" || segment != "" || licName != "" || standard != "" || planCategory != "") { let portfolioAssignmentArray = []; let checkedArray = datatable.getRows(); datatable.clearToastMessage(); for (var i = 0; i < checkedArray.length; i++) { if (checkedArray[i][0].value == 'true') { console.log(checkedArray); let content = checkedArray[i][1].content; console.log(content); portfolioAssignmentArray.push(content); } } if (portfolioAssignmentArray.length === 0) { $("#editErrorModal").modal("toggle"); } else { $("#editCfrmBoxModal").modal("toggle"); } } else { $("#editErrorModal").modal("toggle"); } } function validateEditPlanBenCats(request) { $.ajax({ type: "POST", contentType: "application/json", url: "validateEditPlanBenCats", data: JSON.stringify(request), dataType: 'json', success: function (res) { if (res.Success != undefined) { $("#editCfrmBoxModal").modal("toggle"); } else { document.getElementById("ErrorMesssage").innerHTML = 'No Benefit Categories Matched, Please Try Again..!'; $("#errorModal").modal("toggle"); } }, error: function (xhr) { alert("Something went wrong while updating plans, please try again..!"); } }); } function OpenInEditor() { if (window.bulkCascade === true) { const valid = bulkCascadeSelectionValidationAfterCocModal(); if (valid) { createBulkCascadePlans(); } $("#editCfrmBoxModal").modal("toggle"); window.bulkCascade = false; return; } let portfolioAssignmentArray = []; let checkedArray = datatable.getRows(); datatable.clearToastMessage(); for (var i = 0; i < checkedArray.length; i++) { if (checkedArray[i][0].value === 'true') { let content = checkedArray[i][1].content; portfolioAssignmentArray.push(content); } } $("#editCfrmBoxModal").modal("toggle"); $('#planAssignmentIdEdit').val(portfolioAssignmentArray.toString()); document.getElementById("portfolioEditor").submit(); } function clearPortfolioSearch(){ showAndHide(); setTimeout(function() { $('#planCode').val(""); $('#planName').val(""); $('#stateName').multiselect("clearSelection"); $('#cocSeries').multiselect("clearSelection"); $('#hiosPlanID').val(""); $('#standard').multiselect("clearSelection"); $("#licName").multiselect("clearSelection"); $("#planStatus").multiselect("clearSelection"); $("#planValidateStatus").multiselect("clearSelection"); $("#metallicLevel").multiselect("clearSelection"); $("#planVariant").multiselect("clearSelection"); $('#noResult').css('display', 'none'); $('#datatable').css('display', 'none'); showAndHide(); }, 300); disabledButtons(); $('#clearPortfolio').prop('disabled', true); } $(document).ready(function () { $(':text').on('input', function () { if ($(':text').filter(function () { return !!this.value; }).length > 0) { $('#clearPortfolio').prop('disabled', false); } else { if($('#stateName').val().length == 0 && $('#cocSeries').val().length == 0 && $('#standard').val().length == 0 && $('#licName').val().length == 0 && $('#planStatus').val().length == 0 && $('#planValidateStatus').val().length == 0 && $('metallicLevel').val().length == 0 && $('#planVariant').val().length == 0){ $('#clearPortfolio').prop('disabled', true); clearPortfolioSearch(); } } }); }); function onOrganizationChange() { var standards = document.getElementById("standards"); const selectedOrg = $('#organization').val(); if (selectedOrg === 'IEX-Individual Exchange') { getIEXOrgProductFamily(standards); } else { getAllProductFamily(standards); } } function removeOptions(selectElement) { if (selectElement) { var i, L = selectElement.options.length - 1; for (i = L; i >= 0; i--) { selectElement.children[i].remove(); } } else { console.error("The select element is null."); } } function getIEXOrgProductFamily(standards) { $.ajax({ url: "portfolioManagement/iex-product-family", type: 'GET', success: function (res) { removeOptions(standards); for (var i = 0; i < res.length; i++) { var option = document.createElement("option"); option.value = res[i]; option.innertText = res[i]; standards.appendChild(option); } } }); } function getAllProductFamily(standards) { $.ajax({ url: "portfolioManagement/all-product-family", type: 'GET', success: function (res) { removeOptions(standards); for (var i = 0; i < res.length; i++) { var option = document.createElement("option"); option.value = res[i]; option.innertText = res[i]; standards.appendChild(option); } } }); } function validateCOM60() { let portfolioAssignmentArray = []; let checkedArray = datatable.getRows(); datatable.clearToastMessage(); var isPublishedPlan = true; for (var i = 0; i < checkedArray.length; i++) { if (checkedArray[i][0].value == 'true') { console.log(checkedArray); let content = checkedArray[i][1].content; let content7 = checkedArray[i][7].content; let content8 = checkedArray[i][8].content; if (content8 == "<th style=\"text-align: center\"><input type=\"checkbox\" class=\"defaultCheckbox\" disabled /></th>") { isPublishedPlan = false; } portfolioAssignmentArray.push(content); } } if (portfolioAssignmentArray.length === 0) { $("#com360ErrorModal").modal("toggle"); } else { if (isPublishedPlan) $("#com360CfrmBoxModal").modal("toggle"); else $("#com360ErrorModal").modal("toggle"); } } function sentToCOM360() { let portfolioAssignmentArray = []; let checkedArray = datatable.getRows(); datatable.clearToastMessage(); for (var i = 0; i < checkedArray.length; i++) { if (checkedArray[i][0].value === 'true') { let content = checkedArray[i][1].content; let planCode = checkedArray[i][2].content; portfolioAssignmentArray.push(content + "-" + planCode); } } var myHeaders = new Headers(); myHeaders.append("Content-Type", "application/json"); var request = {}; request["portfolioAssignmentArray"] = portfolioAssignmentArray; $("#com360CfrmBoxModal").modal("toggle"); console.log(JSON.stringify(request)); showAndHide(); $.ajax({ type: "POST", contentType: "application/json", url: "com360PortfolioMgmt", data: JSON.stringify(request), dataType: 'json', success: function (res) { showAndHide(); getSearchData(); document.getElementById("com360SuccessMessage").innerHTML = res.com360Result; $("#com360Success").toast("show"); }, error: function (xhr) { showAndHide(); console.log(xhr); alert("Error while Sent to COM360 plans"); } }); datatable.destroy(); disabledButtons(); } function onlyNumberKey(evt) { var ASCIICode = (evt.which) ? evt.which : evt.keyCode if (ASCIICode > 31 && (ASCIICode < 48 || ASCIICode > 57)) { document.getElementById("ErrorMesssage").innerHTML = 'COC Series should be Numeric.'; $("#createNewPlanModal").modal("hide"); $("#errorModalCOC").modal("toggle"); return false; } return true; } function resetIfInvalid(el) { if (el.value == "") { return; } var options = el.list.options; for (var i = 0; i < options.length; i++) { if (el.value == options[i].value) { return; } } el.value = ""; } function clearCocSelected() { $('#plansCount').val(""); $('#cocSeriesNew').val(""); } let originalProductFamily = []; let originalPlanStatus = []; let originalMetallicLevel = []; function getPortfolioIfpDropdowns(){ showAndHide(); var cocName = $('#cocSeries').val(); let cocSeries= cocName.length > 0 ? cocName.toString() : ""; if (cocSeries === "") { restoreOriginalDropdownValues(); showAndHide(); } else { originalProductFamily = getDropdownValues("standard"); originalPlanStatus = getDropdownValues("planStatus"); originalMetallicLevel = getDropdownValues("metallicLevel"); $.ajax({ type: "POST", contentType: "application/json", url: "getPortfolioIfpDropdowns", data: cocSeries, dataType: 'json', success: function(res) { updateProductFamilyDropDown(res[0]) updatePlanStatusDropDown(res[1]) updateMetallicLevelDropDown(res[2]) showAndHide(); } }); } } function getDropdownValues(dropdownId) { let values = []; $(`#${dropdownId} option`).each(function() { values.push($(this).val()); }); return values; } function restoreOriginalDropdownValues() { updateProductFamilyDropDown(originalProductFamily); updatePlanStatusDropDown(originalPlanStatus); updateMetallicLevelDropDown(originalMetallicLevel); } function updateProductFamilyDropDown(res){ var standards = document.getElementById("standard"); $("#standard option").remove(); $('#standard').multiselect('rebuild'); for (var i = 0; i < res.length; i++) { var option = document.createElement("option"); option.value = res[i]; option.innerText = res[i]; standards.appendChild(option); } $('#standard').multiselect('rebuild'); } function updatePlanStatusDropDown(res){ var planStatus = document.getElementById("planStatus"); $("#planStatus option").remove(); $('#planStatus').multiselect('rebuild'); for (var i = 0; i < res.length; i++) { var option = document.createElement("option"); option.value = res[i]; option.innerText = res[i]; planStatus.appendChild(option); } $('#planStatus').multiselect('rebuild'); } function updateMetallicLevelDropDown(res){ var metallicLevel = document.getElementById("metallicLevel"); $("#metallicLevel option").remove(); for (var i = 0; i < res.length; i++) { var option = document.createElement("option"); option.value = res[i]; option.innerText = res[i]; metallicLevel.appendChild(option); } $('#metallicLevel').multiselect('rebuild'); } function getSelectedPortfolioAssignments() { const rows = datatable.getRows(); const selected = []; for (let i = 0; i < rows.length; i++) { if (rows[i][0].value === 'true') { const planAssignmentId = rows[i][1].content; const planCode = rows[i][2].content; if (planAssignmentId && planCode) { selected.push(planAssignmentId + "-" + planCode); } } } return selected; } function toggleBulkCascadeButton() { const btn = document.getElementById("createBulkCascadePlans"); if (!btn) return; if (btn.dataset.roleLocked === "true") return; btn.disabled = getSelectedPortfolioAssignments().length === 0; } $(document).on("change", ".defaultCheckbox", toggleBulkCascadeButton); $(document).ready(function () { toggleBulkCascadeButton(); }); function createBulkCascadePlans() { const selected = getSelectedPortfolioAssignments(); if (selected.length === 0) { $("#publishErrorMesssage").html("Please select one or more plans from the grid."); $("#publishErrorModal").modal("toggle"); return; } const payload = { portfolioAssignmentArray: selected }; showAndHide(); $.ajax({ type: "POST", url: "generateBulkCascadeData", contentType: "application/json", data: JSON.stringify(payload), success: function (res) { showAndHide(); $("#successCascadeMessage").text(res); $("#successCascadeMessage").toast("show"); }, error: function (xhr) { showAndHide(); $("#publishErrorMesssage").html(xhr.responseText || "Bulk Cascade failed."); $("#publishErrorModal").modal("toggle"); }, complete: function () { afterActionFinalize(); } }); } let bulkCascadeContext = { state: null, coc: null }; function runBulkCascadeSelectionValidation() { const btn = document.getElementById("createBulkCascadePlans"); if (btn && btn.dataset.roleLocked === "true") return false; if (typeof datatable === "undefined") return false; const rows = datatable.getRows(); const selectedIdx = []; for (let i = 0; i < rows.length; i++) { if (rows[i][0].value === "true") selectedIdx.push(i); } if (selectedIdx.length === 0) { $("#publishErrorMesssage").html("Please select one or more plans from the grid."); $("#publishErrorModal").modal("toggle"); return false; } const pairKeyCounts = new Map(); selectedIdx.forEach(i => { const coc = rows[i][3].content; const state = rows[i][4].content; const key = state + "|" + coc; pairKeyCounts.set(key, (pairKeyCounts.get(key) || 0) + 1); }); if (pairKeyCounts.size !== 1) { $("#publishErrorMesssage").html("You have selected plans across multiple States and / or COC Series. Please select plans for only one State and COC Series for Bulk Cascade."); $("#publishErrorModal").modal("toggle"); return false; } const [[singleKey, selectedCount]] = [...pairKeyCounts.entries()]; const [state, coc] = singleKey.split("|"); let totalForPair = 0; for (let i = 0; i < rows.length; i++) { if (rows[i][3].content === coc && rows[i][4].content === state) totalForPair++; } if (selectedCount !== totalForPair) { $("#publishErrorMesssage").html("Please select ALL State " + state + " and COC Series " + coc + " plans before you Bulk Cascade."); $("#publishErrorModal").modal("toggle"); return false; } bulkCascadeContext.state = state; bulkCascadeContext.coc = coc; return true; } function runServerYearValidationThenConfirm() { showAndHide(); $.ajax({ type: "GET", url: "validateBulkCascade", success: function (res) { showAndHide(); if (res === "hasYearLTCurrentCocSeries") { prepareYearWarningModal(); $("#cocCfrmBoxModal").modal("toggle"); } else if (res === "hasYearGTECurrentCocSeries") { showBulkCascadeFinalConfirm(); } else { $("#successCascadeMessage").text(res); $("#successCascadeMessage").toast("show"); } }, error: function () { showAndHide(); $("#publishErrorMesssage").html("Error while validating bulk cascade plans"); $("#publishErrorModal").modal("toggle"); } }); } function prepareYearWarningModal() { $("#cocCfrmBoxModal #publishAllConfirm") .off("click.bulkCascadeYear") .on("click.bulkCascadeYear", function () { $("#cocCfrmBoxModal").modal("hide"); showBulkCascadeFinalConfirm(); }); } function showBulkCascadeFinalConfirm() { const msg = "Are you sure you want to Bulk Cascade all selected plan(s) for State " + bulkCascadeContext.state + " and COC Series " + bulkCascadeContext.coc + "?"; const bodyEl = document.getElementById("bulkCascadeConfirmText"); if (bodyEl) bodyEl.innerText = msg; $("#bulkCascadeCfrmBoxModal").modal("toggle"); } function startBulkCascade() { window.bulkCascade = true; validateCocSeries('plBulkCascade'); } function bulkCascadeSelectionValidationAfterCocModal() { if (typeof datatable === "undefined") { console.warn("datatable not initialized"); return false; } const rows = datatable.getRows(); const selectedIdx = []; for (let i = 0; i < rows.length; i++) { if (rows[i][0].value === "true") { selectedIdx.push(i); } } if (selectedIdx.length === 0) { $("#publishErrorMesssage").html("Please select one or more plans from the grid."); $("#publishErrorModal").modal("toggle"); return false; } const pairCounts = new Map(); selectedIdx.forEach(i => { const coc = rows[i][3].content; const state = rows[i][4].content; const key = state + "|" + coc; pairCounts.set(key, (pairCounts.get(key) || 0) + 1); }); if (pairCounts.size !== 1) { $("#publishErrorMesssage").html("You have selected plans across multiple States and / or COC Series. Please select plans for only one State and COC Series for Bulk Cascade."); $("#publishErrorModal").modal("toggle"); return false; } const [[singleKey, selectedCount]] = [...pairCounts.entries()]; const [state, coc] = singleKey.split("|"); let totalForPair = 0; for (let i = 0; i < rows.length; i++) { if (rows[i][3].content === coc && rows[i][4].content === state) { totalForPair++; } } if (selectedCount !== totalForPair) { $("#publishErrorMesssage").html("Please select ALL State " + state + " and COC Series " + coc + " plans before you Bulk Cascade."); $("#publishErrorModal").modal("toggle"); return false; } return true; } function restoreButtonsFromSelection() { if (!window.datatable) return; const rows = datatable.getRows ? datatable.getRows() : []; let anyChecked = false; for (let i = 0; i < rows.length; i++) { if (rows[i][0].value === 'true') { anyChecked = true; break; } } if (anyChecked) { enableButtons(); toggleBulkCascadeButton(); } else { disabledButtons(); } } function afterActionFinalize() { restoreButtonsFromSelection(); }

snippet of jsp
<div class="row serchfilters" style="margin-top: 1em;"> <div class="col"> <div class="form-floating"> <input type="text" class="form-control" name="planCode" id="planCode" placeholder="Plan Code"> <label for="planCode" class="form-label">Plan Code</label> </div> </div> <div class="col"> <div class="form-floating"> <input type="text" class="form-control" name="planName" id="planName" placeholder="Plan Name"> <label for="planName" class="form-label">Plan Name</label> </div> </div> <div class="col"> <div class="form-floating"> <select id="stateName" class="form-control" multiple="multiple" onchange="return multiselectChange(event)"> <c:forEach var="state" items="${portfolioDD.stateMap}"> <option id="${state.key}" value="${state.key}">${state.key}</option> </c:forEach> </select> </div> </div> <div class="col"> <div class="form-floating"> <select id="cocSeries" class="form-control" multiple="multiple" onchange="return multiselectChange(event),getPortfolioIfpDropdowns()"> <c:forEach var="coc" items="${portfolioDD.cocSeriesMap}"> <option id="${coc.key}" value="${coc.key}">${coc.value}</option> </c:forEach> </select> </div> </div>
