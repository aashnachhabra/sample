 try:
        response = openai.ChatCompletion.create(
            engine="gpt-4-deployment",
            messages=messages,
            temperature=0.5
        )
        return {"response": response.choices[0].message.content}
    except Exception as e:
        logging.error(f"Chat API error: {str(e)}")
        raise HTTPException(status_code=500, detail=f"Chat API error: {str(e)}")

rewrite this to make it compatible with openai v 1.2.3
